#####################################################################
#
# Do not edit this file manually, it is automatically generated.
# Run "yarn charts" instead.
#
#####################################################################

service:
  name: 'user-notification-cleanup-worker'
  args:
    - '--no-experimental-fetch'
    - 'main.js'
    - '--job=cleanup'
  command:
    - 'node'
  enabled: true
  env:
    DB_HOST: 'postgres-applications.internal'
    DB_NAME: 'user_notification'
    DB_REPLICAS_HOST: 'postgres-applications.internal'
    DB_USER: 'user_notification'
    LOG_LEVEL: 'info'
    NODE_OPTIONS: '--max-old-space-size=230 -r dd-trace/init'
    SERVERSIDE_FEATURES_ON: ''
  grantNamespaces:
    - 'nginx-ingress-internal'
    - 'islandis'
    - 'identity-server-delegation'
  grantNamespacesEnabled: true
  healthCheck:
    liveness:
      initialDelaySeconds: 3
      path: '/'
      timeoutSeconds: 3
    readiness:
      initialDelaySeconds: 3
      path: '/'
      timeoutSeconds: 3
  hpa:
    scaling:
      metric:
        cpuAverageUtilization: 90
        nginxRequestsIrate: 5
      replicas:
        max: 3
        min: 1
  image:
    repository: '821090935708.dkr.ecr.eu-west-1.amazonaws.com/services-user-notification'
  initContainer:
    containers:
      - args:
          - 'sequelize-cli'
          - 'db:migrate'
        command:
          - 'npx'
        name: 'migrations'
        resources:
          limits:
            cpu: '200m'
            memory: '256Mi'
          requests:
            cpu: '50m'
            memory: '128Mi'
    env:
      DB_HOST: 'postgres-applications.internal'
      DB_NAME: 'user_notification'
      DB_REPLICAS_HOST: 'postgres-applications.internal'
      DB_USER: 'user_notification'
      SERVERSIDE_FEATURES_ON: ''
    secrets:
      DB_PASS: '/k8s/user-notification/DB_PASSWORD'
  namespace: 'user-notification'
  podDisruptionBudget:
    maxUnavailable: 1
  podSecurityContext:
    fsGroup: 65534
  pvcs: []
  replicaCount:
    default: 1
    max: 3
    min: 1
  resources:
    limits:
      cpu: '200m'
      memory: '256Mi'
    requests:
      cpu: '100m'
      memory: '128Mi'
  schedule: '@midnight'
  secrets:
    CONFIGCAT_SDK_KEY: '/k8s/configcat/CONFIGCAT_SDK_KEY'
    DB_PASS: '/k8s/user-notification/DB_PASSWORD'
  securityContext:
    allowPrivilegeEscalation: false
    privileged: false
  serviceAccount:
    annotations:
      eks.amazonaws.com/role-arn: 'arn:aws:iam::261174024191:role/user-notification-cleanup-worker'
    create: true
    name: 'user-notification-cleanup-worker'
